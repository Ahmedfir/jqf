# JQF: A feedback-directed fuzz testing platform for Java

JQF is built on top of [junit-quickcheck](https://github.com/pholser/junit-quickcheck), which itself lets you write [Quickcheck](http://www.cse.chalmers.se/~rjmh/QuickCheck/manual.html)-like generators and properties in a [Junit](http://junit.org)-style test class. JQF enables better input generation using state-of-the-art fuzzing tools such as [AFL](http://lcamtuf.coredump.cx/afl). 

## Quickstart

Write a Junit-like test class annotated with `@RunWith(JQF.class)` and write some test methods annotated with `@Fuzz`. The arguments to the test methods will be fuzzed by JQF:

```java
@RunWith(JQF.class)
public class DateFormatterTest {

    /* Input params will be generated by JQF, many times. */
    /* Exceptions listed in the "throws" clause are considered normal (tests will pass on throw) */
    @Fuzz
    public void fuzzSimple(Date date, String format) throws IllegalArgumentException {
        // Create a simple date formatter using the input format string
        // May throw IllegalArgumentException for invalid formats
        DateFormat df = new SimpleDateFormat(format);

        // Format the date using the constructed formatter
        df.format(date);
    }
}
```


Fuzz with AFL:
```bash
$ jqf/bin/jqf-afl-fuzz DateFormatterTest fuzzSimple
```

Grab a coffee while AFL does its thing:

![AFL status screen](https://raw.githubusercontent.com/wiki/rohanpadhye/jqf/images/AFL-DateFormatter.png?token=AECYMpic7QZ24GarENgw-UNtuD8c93kHks5aOG25wA%3D%3D)

Ooh! We found some crashes. Let's reproduce one such test case and see what the error was.

```
$ jqf/bin/jqf-repro DateFormatterTest fuzzSimple fuzz-results/crashes/id:000000
java.lang.ArrayIndexOutOfBoundsException: 127
	at java.text.SimpleDateFormat.subFormat(SimpleDateFormat.java)
	at java.text.SimpleDateFormat.format(SimpleDateFormat.java)
	at java.text.SimpleDateFormat.format(SimpleDateFormat.java)
	at java.text.DateFormat.format(DateFormat.java)
```

This shouldn't happen! `DateFormat.format()` does not specify that it will throw `ArrayIndexOutOfBoundsException`. Time to file a bug report :-)


## Building 

To build JQF, you need Maven (`mvn`) and GNU Make (`make`) installed and on your path. 

You also need a local copy of [AFL](lcamtuf.coredump.cx/afl) (run `make` to build AFL in its directory). 

Set the environment variable `AFL_DIR` to point to this directory and run `setup.sh` in the JQF directory.

```bash
export AFL_DIR=/path/to/afl
git clone https://github.com/rohanpadhye/jqf
jqf/scripts/setup.sh 
```

## Documentation

The [JQF wiki](https://github.com/rohanpadhye/jqf/wiki) contains lots more documentation including how to write a JQF test, how to fuzz JQF with AFL, how to analyze/debug crashes and how to extend JQF to use a different fuzzing front-end.
